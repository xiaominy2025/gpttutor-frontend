# V1.6.5 Domain-Based Follow-up Question Design

## ðŸŽ¯ Overview
Implemented a sophisticated domain-based follow-up question system that adapts the number and distribution of questions based on the strategic thinking lens domains identified in the response.

## âœ¨ Design Philosophy

### **Intelligent Adaptation**
Instead of a fixed number of follow-up questions, the system now:
- **Analyzes the strategic thinking lens** to identify domains
- **Adapts question count** based on domain complexity
- **Distributes questions** across identified domains
- **Maintains user experience** with predictable 2-4 question range

### **Domain Detection Logic**
Based on existing test cases and backend patterns, the system identifies:
- **`strategic_mindset`**: Strategic thinking, planning, decision-making
- **`analytical_tools`**: Analytical frameworks, methods, techniques
- **`human_behavior`**: Human psychology, dynamics, interactions
- **`general`**: No specific domain identified

## ðŸŽ¯ Implementation

### **1. Domain Detection (`src/utils/domainDetector.js`)**

#### **Pattern-Based Detection**
```javascript
const domainPatterns = {
  strategic_mindset: [
    'strategic mindset', 'strategic thinking', 'strategic approach',
    'strategic perspective', 'strategic framework', 'strategic decision',
    'strategic planning', 'strategic analysis', 'strategic position',
    'strategic advantage', 'strategic choice', 'strategic option'
  ],
  analytical_tools: [
    'analytical tools', 'analytical framework', 'analytical approach',
    'analytical method', 'analytical technique', 'analytical process',
    'analytical thinking', 'analytical model', 'analytical assessment',
    'analytical evaluation', 'analytical perspective', 'analytical lens'
  ],
  human_behavior: [
    'human behavior', 'human psychology', 'human dynamics',
    'human interaction', 'human factors', 'human element',
    'human aspect', 'human dimension', 'human perspective',
    'human consideration', 'human motivation', 'human response',
    'human reaction', 'human decision', 'human choice',
    'human preference', 'human bias', 'human emotion',
    'human communication', 'human relationship', 'human conflict',
    'human negotiation', 'human persuasion', 'human influence'
  ]
};
```

#### **Robust Detection Features**
- **Case Insensitive**: Matches regardless of capitalization
- **Word Boundaries**: Prevents false positives with partial matches
- **Pattern Matching**: Uses regex for precise detection
- **Error Handling**: Gracefully handles null/undefined input

### **2. Question Count Logic**

#### **General Domain (No specific domains)**
- **Follow-up Questions**: 2 questions only
- **Focus**: 1 question related to each concept
- **Rationale**: Broad coverage without overwhelming

#### **Single Domain (1 domain identified)**
- **Follow-up Questions**: 3 questions
- **Focus**: All related to concepts in that domain
- **Rationale**: Deep dive into the primary domain

#### **Multiple Domains (2+ domains identified)**
- **Primary Domain**: 2 questions related to concepts
- **Additional Domains**: 1 question per additional domain
- **Cap**: Maximum 4 questions total
- **Rationale**: Balanced coverage across domains

### **3. Question Distribution Algorithm**

```javascript
export function getQuestionDistribution(domains) {
  if (!domains || domains.length === 0) {
    return { general: 2 }; // General domain: 2 questions
  }
  
  if (domains.length === 1) {
    return { [domains[0]]: 3 }; // Single domain: 3 questions
  }
  
  // Multiple domains: Primary gets 2, others get 1 each, capped at 4
  const distribution = {};
  const maxQuestions = Math.min(domains.length + 1, 4);
  
  // Primary domain gets 2 questions
  distribution[domains[0]] = 2;
  
  // Additional domains get 1 question each
  let remainingQuestions = maxQuestions - 2;
  for (let i = 1; i < domains.length && remainingQuestions > 0; i++) {
    distribution[domains[i]] = 1;
    remainingQuestions--;
  }
  
  return distribution;
}
```

## ðŸ“Š Example Scenarios

### **Scenario 1: Single Domain (Strategic Mindset)**
```javascript
// Input: "This requires strategic thinking to evaluate options and make informed decisions."
// Detected: ['strategic_mindset']
// Result: 3 questions focused on strategic mindset concepts
// Distribution: { strategic_mindset: 3 }
```

### **Scenario 2: Multiple Domains (Strategic + Analytical)**
```javascript
// Input: "This requires strategic thinking and analytical tools for equipment financing."
// Detected: ['strategic_mindset', 'analytical_tools']
// Result: 3 questions total (2 strategic + 1 analytical)
// Distribution: { strategic_mindset: 2, analytical_tools: 1 }
```

### **Scenario 3: All Three Domains**
```javascript
// Input: "This requires strategic thinking, analytical tools, and human behavior considerations."
// Detected: ['strategic_mindset', 'analytical_tools', 'human_behavior']
// Result: 4 questions total (2 strategic + 1 analytical + 1 human behavior)
// Distribution: { strategic_mindset: 2, analytical_tools: 1, human_behavior: 1 }
```

### **Scenario 4: General Domain**
```javascript
// Input: "This is a general decision-making scenario without specific domain requirements."
// Detected: []
// Result: 2 questions only (1 per concept)
// Distribution: { general: 2 }
```

## âœ… Quality Assurance

### **Comprehensive Testing (`src/utils/domainDetector.test.js`)**
- **22 Test Cases**: All passing
- **Domain Detection**: Tests for each domain type
- **Edge Cases**: Null, undefined, empty input handling
- **Case Sensitivity**: Verifies case-insensitive matching
- **Integration**: Matches existing test case expectations

### **Test Coverage**
- âœ… **Domain Detection**: All three domains + general
- âœ… **Question Count**: 2-4 question range validation
- âœ… **Distribution Logic**: Correct allocation across domains
- âœ… **Edge Cases**: Error handling and boundary conditions
- âœ… **Integration**: Compatibility with existing test cases

## ðŸš€ Benefits

### **1. Intelligent Adaptation**
- **Context-Aware**: Questions adapt to response complexity
- **Domain-Specific**: Follow-up questions match strategic thinking lens
- **Balanced Coverage**: Ensures all identified domains get attention
- **Predictable UX**: Users know to expect 2-4 questions

### **2. Enhanced Learning**
- **Deep Learning**: Single domain gets thorough exploration
- **Broad Learning**: Multiple domains get balanced coverage
- **Concept Mastery**: Questions target specific concepts from response
- **Progressive Complexity**: Scales with response sophistication

### **3. User Experience**
- **Manageable**: Never overwhelming, always purposeful
- **Relevant**: Questions directly relate to concepts discussed
- **Engaging**: Varied question distribution maintains interest
- **Consistent**: Predictable 2-4 question range

### **4. Technical Excellence**
- **Robust Detection**: Handles edge cases and variations
- **Performance Optimized**: Efficient pattern matching
- **Maintainable**: Clear, well-documented code
- **Testable**: Comprehensive test coverage

## ðŸŽ¯ Integration Points

### **Frontend Integration**
```javascript
import { analyzeFollowUpStrategy } from './utils/domainDetector.js';

// In App.jsx or query processing
const analysis = analyzeFollowUpStrategy(strategicThinkingLens);
console.log(`Expected follow-up questions: ${analysis.count}`);
console.log(`Domain distribution:`, analysis.distribution);
```

### **Backend Integration**
The backend can use this logic to:
- **Validate question count** matches domain complexity
- **Ensure question distribution** aligns with identified domains
- **Maintain consistency** between frontend and backend expectations

## ðŸ“ˆ Performance Metrics

### **Detection Accuracy**
- **Strategic Mindset**: 100% detection rate in test cases
- **Analytical Tools**: 100% detection rate in test cases
- **Human Behavior**: 100% detection rate in test cases
- **General Domain**: 100% correct identification

### **Question Distribution**
- **General Domain**: 2 questions (100% accuracy)
- **Single Domain**: 3 questions (100% accuracy)
- **Multiple Domains**: 3-4 questions (100% accuracy)
- **Capping Logic**: 4 question maximum (100% accuracy)

## ðŸŽ‰ Current Status

The domain-based follow-up question system is now fully implemented:

- âœ… **Domain Detection**: Robust pattern-based identification
- âœ… **Question Count Logic**: Intelligent 2-4 question adaptation
- âœ… **Distribution Algorithm**: Balanced allocation across domains
- âœ… **Comprehensive Testing**: 22 test cases, all passing
- âœ… **Integration Ready**: Can be integrated with frontend and backend

This sophisticated design creates a truly adaptive learning experience that scales with response complexity while maintaining excellent user experience.

**Status**: âœ… **DOMAIN-BASED FOLLOW-UP DESIGN COMPLETE** 