# V1.6.5 Backend URL Fix

## Issue
The frontend was trying to fetch course metadata from `localhost:8000` (as configured in .env), but the Flask backend is running on `localhost:5000`. This caused the "Unable to load course data" error shown in the browser.

## Changes Made

### 1. App.jsx Updates
- **Added API_BASE with fallback**: `const API_BASE = import.meta.env.VITE_BACKEND_URL || "http://localhost:5000";`
- **Updated fetchCourseMetadata function**: Now uses `${API_BASE}/api/course/${courseId}` instead of direct environment variable
- **Added console logging**: `console.log("Fetching course metadata from:", url);` to track which URL is being used
- **Improved error handling**: Updated error message to be more descriptive
- **Fixed React Hook dependencies**: Used `useCallback` for `fetchCourseMetadata` to resolve linting warnings

### 2. CourseSelector.jsx Updates
- **Added same API_BASE fallback**: Ensures consistency across components
- **Updated fetch calls**: Uses `${API_BASE}/api/course/${courseId}` instead of direct environment variable
- **Updated useEffect dependencies**: Added `API_BASE` to dependency array

### 3. Environment Configuration
- **Updated .env file**: Changed `VITE_BACKEND_URL` from `http://localhost:8000` to `http://localhost:5000`
- **Maintained fallback**: Even if .env is not loaded, the app will use `http://localhost:5000`

## Testing Plan

### Prerequisites
1. Start Flask backend: `python api_server.py` (runs on port 5000)
2. Start frontend: `npm run dev` (runs on port 5173)

### Test Cases
- ✅ **http://localhost:5173/?course=decision**
  - Expect: Title = "Decision-Making Practice Lab"
  - Console should show: "Fetching course metadata from: http://localhost:5000/api/course/decision"

- ✅ **http://localhost:5173/?course=marketing**
  - Expect: Title = "Marketing Practice Lab"
  - Console should show: "Fetching course metadata from: http://localhost:5000/api/course/marketing"

- ✅ **http://localhost:5173/?course=unknown**
  - Expect: Should fallback to decision course
  - Console should show: "Fetching course metadata from: http://localhost:5000/api/course/unknown"

- ✅ **http://localhost:5173/** (no course param)
  - Expect: Should default to decision course
  - Console should show: "Fetching course metadata from: http://localhost:5000/api/course/decision"

### Error Scenarios
- ✅ **Backend not running**: Should show "Unable to load course data" message
- ✅ **Network error**: Should log error in console and show error message
- ✅ **Invalid JSON response**: Should handle gracefully and show error message

## Console Output Verification

When the app loads successfully, you should see in the browser console:
```
Fetching course metadata from: http://localhost:5000/api/course/decision
```

If there's an error, you should see:
```
Error fetching metadata: [error details]
```

## Benefits

1. **Reliable Backend Connection**: Always targets the correct Flask backend port
2. **Environment Flexibility**: Works with or without .env file
3. **Better Debugging**: Console logs show exactly which URL is being used
4. **Consistent Error Handling**: Clear error messages for troubleshooting
5. **Code Quality**: Fixed React Hook dependency warnings

## File Changes Summary

### Modified Files
1. **src/App.jsx** - Added API_BASE fallback and improved error handling
2. **src/components/CourseSelector.jsx** - Added same API_BASE fallback for consistency
3. **.env** - Updated to use correct backend URL (localhost:5000)

### No Changes Required
- All other app logic remains unchanged
- Only the metadata fetch calls were updated
- UI and user experience remain the same

## Conclusion

The fix ensures that the frontend always targets the Flask backend on port 5000, regardless of environment variable configuration. The app now provides clear console logging for debugging and maintains robust error handling for network issues.

The implementation is ready for testing with the Flask backend running on port 5000. 